# Resource to create EBS volumes in Account B
resource "aws_ebs_volume" "replicated_volumes" {
  provider    = aws.account_b
  for_each    = { for idx, vol in local.ebs_volumes : idx => vol }
  
  availability_zone = "us-east-1a"  # Replace with your desired AZ in Account B
  size              = each.value.volume_size
  type              = each.value.volume_type

  tags = {
    SourceInstance = data.aws_instance.target_instance.id
    DeviceName     = each.value.device_name
    ReplicatedBy   = "Terraform Automation"
  }
}

resource "aws_volume_attachment" "attach_replicated_volumes" {
  provider          = aws.account_b
  count             = length(aws_ebs_volume.replicated_volumes)
  device_name       = local.ebs_volumes[count.index].device_name
  volume_id         = aws_ebs_volume.replicated_volumes[count.index].id
  instance_id       = aws_instance.target_instance.id
  force_detach      = false  # Set to true if you want to force detach
}

